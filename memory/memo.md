# Memory

## memo
メモリのアドレスは16進数が使われている。
`0-9`, `A-F`

2桁の場合、最大値は`FF`
16^1 * 15 + 16^0 * 15 = 240 + 15 = 255
8ビットのバイナリと同じ最大値
値の前に`0x`をつけることで、16進数であることを表す

アドレスを格納する変数をポインタと呼ぶ

現代のコンピュータシステムは64ビット
64ビットを使用してメモリをアドレス指定するため、
ポインタは実際には8バイトになる

```c
#include <stdio.h>

int main(void)
{
    char *s = "HI!";
    printf("%c\n", s[0]);
    printf("%c\n", s[1]);
    printf("%c\n", s[2]);
}
// ➜  memory git:(main) ✗ gcc -o 01_test 01_test.c && ./01_test   
// H
// I
// !
```


```c
int main(void)
{
    char *s = "HI!";
    printf("%c\n", *s);
    // *sに格納されているアドレスの、1バイト上位または次の文字のアドレスを持つメモリアドレスの値を参照する
    // s[1]は*(s+1)のシンタックスシュガー
    printf("%c\n", *(s+1));
    printf("%c\n", *(s+2));
}
// ➜  memory git:(main) ✗ gcc -o 01_test 01_test.c && ./01_test
// H
// I
// !
```

メモリの動的確保
はじめから必要なメモリのサイズがわからない場合、扱いデータの個数やサイズが不明なときや、状況に応じて異なる場合
プログラム起動時に確保されたメモリ以外のメモリを後から追加で確保する方法



malloc
ヒープにメモリを動的に確保する場合にmallocを利用する
確保された領域の先頭を指すポインタ、メモリ不足などの要因で失敗した場合にはヌルポインタが返される
voidへのポインタ型
引数で指定するバイト数分のメモリが確保され、確保したメモリ領域へのポインタを返す
```c
int *addr;
// 戻り値のアドレスをint型の変数へ代入
addr = malloc(4);
```
確保された領域が不要になったらfreeでメモリを開放する

strcpy
```c
#include <string.h>
char *strcpy(char *s1, const char *s2);
```

valgrind
プログラムを実行するために使用できるコマンドラインツール
メモリリークがないかどうか、または解放せずに割り当てたメモリがないかどうかを確認できる

ガベージコレクション
コンピュータが動的に確保したメモリ領域のうち、不要になった領域を自動的に開放する機能
それを行う主体
ガベージコレクタ

メモリレイアウト
マシンコードセクション
コンパイルされたプログラムのバイナリコードです。プログラムを実行すると、そのコードはメモリの「トップ」にロードされる

グローバル変数
またはメモリの次の部分に、プログラムで宣言するグローバル変数がある

ヒープセクション
mallocプログラムが使用する空きメモリを取得できる空の領域
mallocを呼び出すと、メモリの割り当てがトップダウンで開始される

スタックセクション
プログラム内の関数が呼び出されたときに使用され、上に向かって
たとえば、main関数はスタックの一番下にある
